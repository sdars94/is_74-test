# –¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –¥–ª—è –∫–æ–º–ø–∞–Ω–∏–∏ '–ò–Ω—Ç–µ—Ä—Å–≤—è–∑—å'

## –û–ø–∏—Å–∞–Ω–∏–µ

–°–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Ç–æ—á–∫—É –¥–æ—Å—Ç—É–ø–∞ `/process-image`,
–∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ `pipeline_id` - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–∞–π–ø–ª–∞–π–Ω–∞ –∏
`image_file` - —Ñ–∞–π–ª —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ–º.

–°–∂–∞—Ç–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç—Å—è –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ Celery. 
–°–µ—Ä–≤–∏—Å –Ω–∞–ø–∏—Å–∞–Ω –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ.

–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞:

``` json
{
  "id": 23,
  "pipeline_id": 1,
  "status": "detected",
  "filename": "string.jpg",
  "data": {
    "top_left_x": 200,
    "top_left_y": 300,
    "width": 150,
    "height": 50,
    "confidence": 0.8349234234,
    "class_id": 1
  }
}

{
  "id": 23,
  "pipeline_id": 1,
  "status": "undetected",
  "filename": "string.jpg",
  "data": []
}
```

### –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:

Python 3.10, FastAPI, PostgreSQL (asyncpg), SQLAlchemy, Redis, Alembic,
Celery, Flower, Numpy, Opencv-python, Gunicorn, Docker.

## –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –¥–ª—è –∑–∞–ø—É—Å–∫–∞

#### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∏ –ø–µ—Ä–µ–π—Ç–∏ –≤ –Ω–µ–≥–æ –≤ –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–µ.

```bash
git clone https://github.com/sdars94/is_74-test.git
cd  .\is_74-test\deployment
```

#### 2. –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –ø—Ä–æ–µ–∫—Ç:

##### –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ Git Bash –∏ Docker —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –Ω–∞ –≤–∞—à–µ–º –ü–ö

``` bash
# –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ deployment\
# —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Docker –∑–∞–ø—É—â–µ–Ω
# –∑–∞–ø—É—Å—Ç–∏—Ç–µ bash —Å–∫—Ä–∏–ø—Ç
.\run.sh
# –¥–æ–∂–¥–∏—Ç–µ—Å—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è "DB restoration finished." –≤ —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
```

## –†–µ—Å—É—Ä—Å—ã

–°–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏
–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: [üîóIMG-processing-service](http://localhost:8000/docs)

–°–µ—Ä–≤–∏—Å –∏–º–∏—Ç–∞—Ü–∏–∏ ML: [üîóML-service](http://localhost:5000/docs)

–°–µ—Ä–≤–∏—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è
Celery: [üîóFlower](http://localhost:5555)

## –¢–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è

<details>
<summary>–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å.</summary>

–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ –ø–æ–∑–∏—Ü–∏—é Python Backend Developer

–û–ø–∏—Å–∞–Ω–∏–µ
–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –≤–∏–¥–µ–æ–∞–Ω–∞–ª–∏—Ç–∏–∫–∏ ‚Äì no-code –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞-–∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è —Å–æ–±–∏—Ä–∞—Ç—å
—Å—Ü–µ–Ω–∞—Ä–∏–∏ –≤–∏–¥–µ–æ–∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç–∞ –∏
–∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ –∑—Ä–µ–Ω–∏—è –±–µ–∑ –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫–æ–¥–∞.
–í —Ä–∞–º–∫–∞—Ö —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–ø—Ä–æ—â–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –æ–¥–Ω–æ–≥–æ –∏–∑
—Å–µ—Ä–≤–∏—Å–æ–≤ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã - —Å–µ—Ä–≤–∏—Å–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
–ó–∞–¥–∞–Ω–∏–µ
–¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å REST API —Å–µ—Ä–≤–∏—Å, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –Ω–∞ –≤—Ö–æ–¥ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏
–ø—Ä–æ–≥–æ–Ω—è–µ—Ç –∏—Ö –ø–æ —Ä–∞–∑–ª–∏—á–Ω—ã–º –ø–∞–π–ø–ª–∞–π–Ω–∞–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π.
–°–∞–º–∏ –ø–∞–π–ø–ª–∞–π–Ω—ã –¥–æ–ª–∂–Ω—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —á–µ—Ä–µ–∑ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö. –¢–æ –µ—Å—Ç—å –≤ –±–∞–∑–µ
—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Å–∞–º–∏ –ø–∞–π–ø–ª–∞–π–Ω—ã –∏ —à–∞–≥–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–¥–µ–ª–∞—Ç—å –≤
—Ä–∞–º–∫–∞—Ö –ø–∞–π–ø–ª–∞–π–Ω–æ–≤. –ü—Ä–∏ —ç—Ç–æ–º, —Å–∞–º–∏ –ø–∞–π–ø–ª–∞–π–Ω—ã –¥–∏–Ω–∞–º–∏—á–Ω—ã –∏ –º–æ–≥—É—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è —Å–æ
–≤—Ä–µ–º–µ–Ω–µ–º.

–í —Ä–∞–º–∫–∞—Ö —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø–∞–π–ø–ª–∞–π–Ω –¥–µ—Ç–µ–∫—Ü–∏–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—è.
–ü–∞–π–ø–ª–∞–π–Ω —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Å–ª–µ–¥—É—é—â–∏—Ö —à–∞–≥–æ–≤:

1. –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
2. –ü—Ä–æ–≥–æ–Ω –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ –º–æ–¥–µ–ª—å –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è
3. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∑–∞–¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω –ª–∏ –Ω–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –∞–≤—Ç–æ–º–æ–±–∏–ª—å, –∞
   —Ç–∞–∫–∂–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –±–æ–∫—Å–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è, –µ—Å–ª–∏ –æ–Ω –∑–∞–¥–µ—Ç–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω

–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è —Å–ª–µ–¥—É—é—â–∏–µ —ç—Ç–∞–ø—ã:

1. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ numpy-–º–∞—Å—Å–∏–≤. –î–ª—è —ç—Ç–æ–≥–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è
   –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π numpy –∏ –º–µ—Ç–æ–¥–æ–º frombuffer
2. –°—á–∏—Ç–∞—Ç—å numpy-–º–∞—Å—Å–∏–≤ —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ opencv-python, –º–µ—Ç–æ–¥–∞ imdecode
3. –ò–∑–º–µ–Ω–∏—Ç—å —Ä–∞–∑–º–µ—Ä –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–æ —Ä–∞–∑–º–µ—Ä–∞ 640x640. –ú–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å –ø–æ–º–æ—â—å—é
   –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ opencv-python, –º–µ—Ç–æ–¥–∞ resize.
4. –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ. –ú–æ–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å –ø–æ–º–æ—â—å—é –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
   opencv-python, –º–µ—Ç–æ–¥–∞ normalize.
5. –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ base64-—Å—Ç—Ä–æ–∫—É. –î–ª—è —ç—Ç–æ–≥–æ
   –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–Ω–∞—á–∞–ª–∞ –Ω—É–∂–Ω–æ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –≤ –±–∞–π—Ç—ã, –∞ –∑–∞—Ç–µ–º –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å
   –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π base64

–í—Ç–æ—Ä–æ–π –ø—É–Ω–∫—Ç —Ç—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –≤ –≤–∏–¥–µ –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞, –∫–æ—Ç–æ—Ä—ã–π
–±—É–¥–µ—Ç –∏–º–∏—Ç–∏—Ä–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É –º–æ–¥–µ–ª–∏ –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è. –ù–∞ –≤—Ö–æ–¥ —Å–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω
–ø–æ–ª—É—á–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –ø–æ—Å–ª–µ —á–µ–≥–æ —Å —à–∞–Ω—Å–æ–º 50/50 –≤—ã–¥–∞–≤–∞—Ç—å –ª–∏–±–æ
–ø—É—Å—Ç–æ–π –æ—Ç–≤–µ—Ç, –ª–∏–±–æ –∑–∞—Ä–∞–Ω–µ–µ –∑–∞–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –±–æ–∫—Å–∞ –∞–≤—Ç–æ–º–æ–±–∏–ª—è -
–ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞, –≤–Ω—É—Ç—Ä–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–∞–π–¥–µ–Ω –∞–≤—Ç–æ–º–æ–±–∏–ª—å. –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç - [top_left_x, top_left_y, w, h, conf, label], –≥–¥–µ top_left_x -
–∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ –ø–æ –æ—Å–∏ X –≤–µ—Ä—Ö–Ω–µ–π –ª–µ–≤–æ–π —Ç–æ—á–∫–∏ –±–æ–∫—Å–∞, top_left_y - –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞ –ø–æ –æ—Å–∏ Y
–≤–µ—Ä—Ö–Ω–µ–π –ª–µ–≤–æ–π —Ç–æ—á–∫–∏ –±–æ–∫—Å–∞, w - —à–∏—Ä–∏–Ω–∞ –±–æ–∫—Å–∞ (–≤ –ø–∏–∫—Å–µ–ª—è—Ö), h - –≤—ã—Å–æ—Ç–∞ –±–æ–∫—Å–∞ (–≤
–ø–∏–∫—Å–µ–ª—è—Ö), conf - —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –º–æ–¥–µ–ª–∏ (–æ—Ç 0 –¥–æ 1), label - –∫–ª–∞—Å—Å –º–æ–¥–µ–ª–∏ - –≤
–¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ —ç—Ç–æ 1, –ø–æ—Å–∫–æ–ª—å–∫—É –∞–≤—Ç–æ–º–æ–±–∏–ª—å –Ω–∞–π–¥–µ–Ω.

–°–ª–µ–¥—É–µ—Ç —É—á–µ—Å—Ç—å, —á—Ç–æ –≤ –∏–¥–µ–∞–ª–µ —Å–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–ø–æ—Å–æ–±–µ–Ω –≤—ã–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ
–±–æ–ª—å—à—É—é –Ω–∞–≥—Ä—É–∑–∫—É - –¥–æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Ç—ã—Å—è—á –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –º–∏–Ω—É—Ç—É. –õ–∏–±–æ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å
–ø–æ–Ω–∏–º–∞–Ω–∏–µ, –∫–∞–∫ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å —Å–µ—Ä–≤–∏—Å, —á—Ç–æ–±—ã –æ–Ω —Å–º–æ–≥ –≤—ã–¥–µ—Ä–∂–∏–≤–∞—Ç—å —Ç–∞–∫—É—é –Ω–∞–≥—Ä—É–∑–∫—É.

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- –°–µ—Ä–≤–∏—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞–ø–∏—Å–∞–Ω –Ω–∞ FastAPI
- –í —Å–µ—Ä–≤–∏—Å–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–µ—Ç–æ–¥ /process_image, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞
–≤—Ö–æ–¥ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç JPEG-–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ id –ø–∞–π–ø–ª–∞–π–Ω–∞. –°–∞–º –º–µ—Ç–æ–¥ –ø—Ä–æ–≥–æ–Ω—è–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
–ø–æ –∑–∞–¥–∞–Ω–Ω–æ–º—É –ø–∞–π–ø–ª–∞–π–Ω—É
- –í –∫–∞—á–µ—Å—Ç–≤–µ –°–£–ë–î –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Postgresql. –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
sqlalchemy
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ Docker, —Å–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è —Å –ø–æ–º–æ—â—å—é docker-compose. –í
—Ç–æ–º —á–∏—Å–ª–µ, —á–µ—Ä–µ–∑ docker-compose –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è postgresql

</details>